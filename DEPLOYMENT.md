# ðŸš€ Free Hosting Deployment Guide

This guide will help you deploy your Adani Bill Collection AI Agent project online for free using Render.com (backend) and Netlify/Vercel (frontend).

## ðŸ“‹ Table of Contents
1. [Prerequisites](#prerequisites)
2. [Backend Deployment (Render.com)](#backend-deployment-rendercom)
3. [Frontend Deployment (Netlify)](#frontend-deployment-netlify)
4. [Frontend Deployment (Vercel) - Alternative](#frontend-deployment-vercel---alternative)
5. [Environment Variables Setup](#environment-variables-setup)
6. [Post-Deployment Configuration](#post-deployment-configuration)
7. [Troubleshooting](#troubleshooting)

---

## Prerequisites

Before deploying, ensure you have:
- âœ… A GitHub account
- âœ… Your project pushed to a GitHub repository
- âœ… VAPI.ai account credentials
- âœ… Twilio account credentials
- âœ… All environment variables ready

---

## Backend Deployment (Render.com)

### Step 1: Push to GitHub

1. Initialize git repository (if not already done):
```bash
git init
git add .
git commit -m "Initial commit"
```

2. Create a new repository on GitHub and push:
```bash
git remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO_NAME.git
git branch -M main
git push -u origin main
```

### Step 2: Deploy on Render.com

1. **Sign up/Login**: Go to [render.com](https://render.com) and sign up (free tier available)

2. **Create New Web Service**:
   - Click "New +" â†’ "Web Service"
   - Connect your GitHub account
   - Select your repository

3. **Configure Service**:
   - **Name**: `adani-bill-collection-api` (or your preferred name)
   - **Environment**: `Python 3`
   - **Build Command**: `pip install -r backend/requirements.txt`
   - **Start Command**: `cd backend && uvicorn app.main:app --host 0.0.0.0 --port $PORT`
   - **Plan**: Select **Free** plan

4. **Add PostgreSQL Database**:
   - Click "New +" â†’ "PostgreSQL"
   - Name: `adani-bill-db`
   - Plan: **Free**
   - Note the connection string (you'll need it)

5. **Set Environment Variables**:
   In the Web Service dashboard, go to "Environment" tab and add:
   ```
   DATABASE_URL=<from PostgreSQL database>
   VAPI_API_KEY=your_vapi_api_key
   VAPI_PHONE_NUMBER_ID=your_vapi_phone_number_id
   VAPI_ASSISTANT_ID=your_vapi_assistant_id
   TWILIO_ACCOUNT_SID=your_twilio_account_sid
   TWILIO_AUTH_TOKEN=your_twilio_auth_token
   TWILIO_PHONE_NUMBER=your_twilio_phone_number
   SECRET_KEY=<auto-generated or set your own>
   API_BASE_URL=https://your-app-name.onrender.com
   FRONTEND_URL=https://your-frontend-name.netlify.app
   DEBUG=false
   ```

6. **Deploy**:
   - Click "Create Web Service"
   - Render will automatically build and deploy your app
   - Wait for deployment to complete (5-10 minutes)
   - Your API will be available at: `https://your-app-name.onrender.com`

### Step 3: Update VAPI Webhook URL

1. Go to your VAPI.ai dashboard
2. Update webhook URLs to point to: `https://your-app-name.onrender.com/api/vapi/webhook`

---

## Frontend Deployment (Netlify)

### Step 1: Prepare Frontend

1. Update the API URL in your frontend:
   - Option 1: Create a `_redirects` file in `frontend/` directory
   - Option 2: Use Netlify environment variables (recommended)

2. Create `frontend/_redirects` file:
```
/*    /index.html   200
```

### Step 2: Deploy on Netlify

1. **Sign up/Login**: Go to [netlify.com](https://netlify.com) and sign up

2. **Deploy Site**:
   - Click "Add new site" â†’ "Import an existing project"
   - Connect to GitHub and select your repository

3. **Build Settings**:
   - **Base directory**: Leave empty (or `frontend` if your frontend is in a subdirectory)
   - **Build command**: Leave empty (static site)
   - **Publish directory**: `frontend`

4. **Environment Variables**:
   - Go to Site settings â†’ Environment variables
   - Add: `API_BASE_URL` = `https://your-app-name.onrender.com`

5. **Update Frontend to Use Environment Variable**:
   - Add this script before closing `</body>` tag in `frontend/index.html`:
   ```html
   <script>
     window.API_BASE_URL = '%API_BASE_URL%' || 'http://localhost:8000';
   </script>
   ```

6. **Deploy**:
   - Click "Deploy site"
   - Netlify will build and deploy your frontend
   - Your site will be available at: `https://random-name.netlify.app`

### Step 3: Custom Domain (Optional)

1. Go to Site settings â†’ Domain management
2. Click "Add custom domain"
3. Follow the instructions to configure your domain

---

## Frontend Deployment (Vercel) - Alternative

### Step 1: Deploy on Vercel

1. **Sign up/Login**: Go to [vercel.com](https://vercel.com) and sign up

2. **Import Project**:
   - Click "Add New" â†’ "Project"
   - Import your GitHub repository

3. **Configure Project**:
   - **Framework Preset**: Other
   - **Root Directory**: `frontend`
   - **Build Command**: Leave empty
   - **Output Directory**: `.` (current directory)

4. **Environment Variables**:
   - Add: `API_BASE_URL` = `https://your-app-name.onrender.com`

5. **Deploy**:
   - Click "Deploy"
   - Vercel will automatically deploy your frontend
   - Your site will be available at: `https://your-project.vercel.app`

---

## Environment Variables Setup

### Backend (Render.com)

All environment variables should be set in Render.com dashboard:

| Variable | Description | Example |
|----------|-------------|---------|
| `DATABASE_URL` | PostgreSQL connection string | Auto-set by Render |
| `VAPI_API_KEY` | Your VAPI API key | `vapi_xxxxx` |
| `VAPI_PHONE_NUMBER_ID` | VAPI phone number ID | `xxxxx` |
| `VAPI_ASSISTANT_ID` | VAPI assistant ID | `xxxxx` |
| `TWILIO_ACCOUNT_SID` | Twilio account SID | `ACxxxxx` |
| `TWILIO_AUTH_TOKEN` | Twilio auth token | `xxxxx` |
| `TWILIO_PHONE_NUMBER` | Twilio phone number | `+1234567890` |
| `SECRET_KEY` | Secret key for JWT/sessions | Generate random string |
| `API_BASE_URL` | Your Render.com API URL | `https://xxx.onrender.com` |
| `FRONTEND_URL` | Your frontend URL | `https://xxx.netlify.app` |
| `DEBUG` | Debug mode | `false` |

### Frontend (Netlify/Vercel)

| Variable | Description | Example |
|----------|-------------|---------|
| `API_BASE_URL` | Your backend API URL | `https://xxx.onrender.com` |

---

## Post-Deployment Configuration

### 1. Update CORS Settings

After deployment, update `backend/app/main.py` CORS settings if needed:
```python
allow_origins=[settings.frontend_url]  # Remove "*" in production
```

### 2. Initialize Database

The database will be automatically initialized on first startup. If you need to seed data:

1. SSH into Render.com (if available) or
2. Use Render.com Shell to run:
```bash
cd backend
python seed_data.py
```

### 3. Test Your Deployment

1. **Backend Health Check**:
   - Visit: `https://your-api.onrender.com/health`
   - Should return: `{"status": "healthy", "service": "bill-collection-ai-agent"}`

2. **API Documentation**:
   - Visit: `https://your-api.onrender.com/docs`
   - Test API endpoints here

3. **Frontend**:
   - Visit: `https://your-frontend.netlify.app`
   - Check browser console for any errors
   - Test API connectivity

### 4. Update Webhook URLs

Update webhook URLs in:
- **VAPI Dashboard**: Point to `https://your-api.onrender.com/api/vapi/webhook`
- **Twilio Dashboard**: Point to `https://your-api.onrender.com/api/twilio/webhook` (if applicable)

---

## Troubleshooting

### Backend Issues

**Problem**: Deployment fails
- **Solution**: Check build logs in Render.com dashboard
- Ensure all dependencies are in `backend/requirements.txt`
- Check Python version compatibility

**Problem**: Database connection error
- **Solution**: Verify `DATABASE_URL` is correctly set
- Ensure PostgreSQL database is created and running
- Check database credentials

**Problem**: Environment variables not working
- **Solution**: Restart the service after adding environment variables
- Verify variable names match exactly (case-sensitive)

### Frontend Issues

**Problem**: API calls failing (CORS error)
- **Solution**: Update `FRONTEND_URL` in backend environment variables
- Check CORS settings in `backend/app/main.py`

**Problem**: API URL not updating
- **Solution**: Clear browser cache
- Verify environment variable is set correctly
- Check browser console for errors

**Problem**: 404 errors on page refresh
- **Solution**: Ensure `_redirects` file exists in `frontend/` directory
- Verify Netlify redirect rules are configured

### General Issues

**Problem**: Free tier limitations
- **Solution**: 
  - Render.com free tier spins down after 15 minutes of inactivity
  - First request after spin-down may take 30-60 seconds
  - Consider upgrading to paid tier for production

**Problem**: Database resets
- **Solution**: 
  - Free tier databases may reset
  - Consider backing up data regularly
  - Use migration scripts for schema changes

---

## ðŸŽ‰ Success!

Once deployed, your application will be available at:
- **Backend API**: `https://your-app-name.onrender.com`
- **Frontend**: `https://your-frontend-name.netlify.app`

### Next Steps:
1. âœ… Test all API endpoints
2. âœ… Verify webhook connectivity
3. âœ… Test SMS and voice call functionality
4. âœ… Monitor logs for any errors
5. âœ… Set up custom domains (optional)

---

## ðŸ“š Additional Resources

- [Render.com Documentation](https://render.com/docs)
- [Netlify Documentation](https://docs.netlify.com)
- [Vercel Documentation](https://vercel.com/docs)
- [FastAPI Deployment Guide](https://fastapi.tiangolo.com/deployment/)

---

## ðŸ’¡ Tips

1. **Monitor Logs**: Regularly check logs in Render.com and Netlify dashboards
2. **Environment Variables**: Keep sensitive keys secure, never commit to Git
3. **Database Backups**: Regularly backup your database (free tier may reset)
4. **Performance**: Free tier has limitations, upgrade for production use
5. **Custom Domains**: Use custom domains for better branding

---

**Need Help?** Check the logs in your hosting provider's dashboard or refer to the troubleshooting section above.

